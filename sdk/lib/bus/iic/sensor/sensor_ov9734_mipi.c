#include "sys_config.h"
#include "typesdef.h"
#include "lib/video/dvp/cmos_sensor/csi.h"
#include "tx_platform.h"
#include "list.h"
#include "dev.h"
#include "hal/isp.h"

/* lens & sensor config information:
- sensor      : ov9734
- fstop       : 1.6
- mclk        : 24MHz
- max FPS     : TBD
- frame length: TBD
- usage       : TEST
- interface   : mipi 2 lane
*/

#if DEV_SENSOR_OV9734

//720*720
SENSOR_INIT_SECTION const unsigned char OV9734InitTable[] =
{
    //sensor inittab 初始化表
	0x01, 0x03, 0x01,
	0x01, 0x00, 0x00,
	0x30, 0x01, 0x00,
	0x30, 0x02, 0x00,
	0x30, 0x07, 0x00,
	0x30, 0x10, 0x00,
	0x30, 0x11, 0x08,
	0x30, 0x14, 0x22,
	0x30, 0x1e, 0x15,   //
	0x30, 0x30, 0x19,
	0x30, 0x80, 0x02,   //12
	0x30, 0x81, 0x3c,   //720
	0x30, 0x82, 0x04,
	0x30, 0x83, 0x00,
	0x30, 0x84, 0x02,
	0x30, 0x85, 0x01,
	0x30, 0x86, 0x01,
	0x30, 0x89, 0x01,   //360
	0x30, 0x8a, 0x00,   //90
	0x31, 0x03, 0x01,
	0x36, 0x00, 0x55,
	0x36, 0x01, 0x02,
	0x36, 0x05, 0x22,
	0x36, 0x11, 0xe7,
	0x36, 0x54, 0x10,
	0x36, 0x55, 0x77,
	0x36, 0x56, 0x77,
	0x36, 0x57, 0x07,
	0x36, 0x58, 0x22,
	0x36, 0x59, 0x22,
	0x36, 0x5a, 0x02,
	0x37, 0x84, 0x05,
	0x37, 0x85, 0x55,
	0x37, 0xc0, 0x07,
	0x38, 0x00, 0x11,//00
	0x38, 0x01, 0x0c,//04
	0x38, 0x02, 0x00,
	0x38, 0x03, 0x04,

	0x38, 0x04, 0x03,//0x05
	0x38, 0x05, 0xf3,//0x0b
	0x38, 0x06, 0x02,
	0x38, 0x07, 0xdb,
	// 0x38, 0x08, 0x05,
	// 0x38, 0x09, 0x00,
	0x38, 0x08, 0x02,
	0x38, 0x09, 0xd0,

	0x38, 0x0a, 0x02,
	0x38, 0x0b, 0xd0,
	0x38, 0x0c, 0x05,
	0x38, 0x0d, 0xc6,
	//	0x38,0x0e,0x03,
	//	0x38,0x0f,0x22,
	0x38, 0x0e, 0x04,
	0x38, 0x0f, 0xbf,
	0x38, 0x10, 0x00,
	0x38, 0x11, 0x04,
	0x38, 0x12, 0x00,
	0x38, 0x13, 0x04,
	0x38, 0x16, 0x00,
	0x38, 0x17, 0x00,
	0x38, 0x18, 0x00,
	0x38, 0x19, 0x04,
	0x38, 0x20, 0x18,
	0x38, 0x21, 0x00,
	0x38, 0x2c, 0x06,
	//AEC control registers
	0x35, 0x00, 0x00,
	0x35, 0x01, 0x31,
	0x35, 0x02, 0x00,
	0x35, 0x03, 0x03,
	0x35, 0x04, 0x00,
	0x35, 0x05, 0x00,
	0x35, 0x09, 0x10,
	0x35, 0x0a, 0x00,
	0x35, 0x0b, 0x40,
	0x3d, 0x00, 0x00,
	0x3d, 0x01, 0x00,
	0x3d, 0x02, 0x00,
	0x3d, 0x03, 0x00,
	0x3d, 0x04, 0x00,
	0x3d, 0x05, 0x00,
	0x3d, 0x06, 0x00,
	0x3d, 0x07, 0x00,
	0x3d, 0x08, 0x00,
	0x3d, 0x09, 0x00,
	0x3d, 0x0a, 0x00,
	0x3d, 0x0b, 0x00,
	0x3d, 0x0c, 0x00,
	0x3d, 0x0d, 0x00,
	0x3d, 0x0e, 0x00,
	0x3d, 0x0f, 0x00,
	0x3d, 0x80, 0x00,
	0x3d, 0x81, 0x00,
	0x3d, 0x82, 0x38,
	0x3d, 0x83, 0xa4,
	0x3d, 0x84, 0x00,
	0x3d, 0x85, 0x00,
	0x3d, 0x86, 0x1f,
	0x3d, 0x87, 0x03,
	0x3d, 0x8b, 0x00,
	0x3d, 0x8f, 0x00,
	0x40, 0x01, 0xe0,
	0x40, 0x09, 0x0b,
	0x43, 0x00, 0x03,
	0x43, 0x01, 0xff,
	0x43, 0x04, 0x00,
	0x43, 0x05, 0x00,
	0x43, 0x09, 0x00,
	0x46, 0x00, 0x00,
	0x46, 0x01, 0x80,
	0x48, 0x00, 0x20,
	0x48, 0x05, 0x00,
	0x48, 0x21, 0x50,
	0x48, 0x23, 0x50,
	0x48, 0x37, 0x2d,
	0x4a, 0x00, 0x00,
	0x4f, 0x00, 0x80,
	0x4f, 0x01, 0x10,
	0x4f, 0x02, 0x00,
	0x4f, 0x03, 0x00,
	0x4f, 0x04, 0x00,
	0x4f, 0x05, 0x00,
	0x4f, 0x06, 0x00,
	0x4f, 0x07, 0x00,
	0x4f, 0x08, 0x00,
	0x4f, 0x09, 0x00,
	0x50, 0x00, 0x2f,
	0x50, 0x0c, 0x00,
	0x50, 0x0d, 0x00,
	0x50, 0x0e, 0x00,
	0x50, 0x0f, 0x00,
	0x50, 0x10, 0x00,
	0x50, 0x11, 0x00,
	0x50, 0x12, 0x00,
	0x50, 0x13, 0x00,
	0x50, 0x14, 0x00,
	0x50, 0x15, 0x00,
	0x50, 0x16, 0x00,
	0x50, 0x17, 0x00,
	0x50, 0x80, 0x00,
	0x51, 0x80, 0x01,
	0x51, 0x81, 0x00,
	0x51, 0x82, 0x01,
	0x51, 0x83, 0x00,
	0x51, 0x84, 0x01,
	0x51, 0x85, 0x00,
	0x57, 0x08, 0x06,
	0x38, 0x0f, 0x2a,  //;22;30fps;DPC
	0x57, 0x80, 0x3e,
	0x57, 0x81, 0x0f,
	0x57, 0x82, 0x44,
	0x57, 0x83, 0x02,
	0x57, 0x84, 0x01,
	0x57, 0x85, 0x01,
	0x57, 0x86, 0x00,
	0x57, 0x87, 0x04,
	0x57, 0x88, 0x02,
	0x57, 0x89, 0x0f,
	0x57, 0x8a, 0xfd,
	0x57, 0x8b, 0xf5,
	0x57, 0x8c, 0xf5,
	0x57, 0x8d, 0x03,
	0x57, 0x8e, 0x08,
	0x57, 0x8f, 0x0c,
	0x57, 0x90, 0x08,
	0x57, 0x91, 0x04,
	0x57, 0x92, 0x00,
	0x57, 0x93, 0x52,
	0x57, 0x94, 0xa3,  //;MWB
	0x50, 0x00, 0x3f,


	// 0x50, 0x80, 0x80,

	0x01, 0x00, 0x01,

	0xff, 0xff, 0xff,
	//SENSOR_TAB_END
};
const _Sensor_CCM ov9734_ccm_init = {
    // 5500k, gamma2p2

    // 0x206, 0xf65, 0xfdc,  // R row
    // 0xf2c, 0x211, 0xf32,  // G row
    // 0xfcb, 0xfba, 0x20c,  // B row
    // 0x001, 0x000, 0xfff   // Offsets




	520,	-175,	-36,
	-212,	520,	-229,
	-53,	-90,	500,
	 0,   	 	0,    	0




};

const _Sensor_BLC ov9734_blc_init =
{
    // 251, 251, 251, 251,
    17<<2, 17<<2, 17<<2, 17<<2, 
};

const _Sensor_AWB ov9734_awb_init = 
{
    .default_gain   = {500, 256, 256, 478},
    .awb_min_gain   = {400, 256, 256, 350},
    .awb_max_gain   = {600, 256, 256, 600},

    .coarse_constraint = {
        .coarse_min_bg = 100,
        .coarse_lb_bg  = 140,
        .coarse_rt_bg  = 150,
        .coarse_max_bg = 170,
        .coarse_min_rg = 80,
        .coarse_lb_rg  = 100,
        .coarse_rt_rg  = 130,
        .coarse_max_rg = 165,
    },

    .constraint = {
        .section_num = 3,
		//   temp:   7500, 6500, 5000
		//  rgain:    596,  570,  488
		//  bgain:    413,  465,  520
		// lower,upper range
		// lower,upper
		//    15,   10
		//    15,   15
		//    20,   15
    	.color_temp          = {        7500,        6500,        5000,           0,           0,           0,           0,           0},
    	.sec_line_slope      = {  0.27777778,  0.72727273,   1.2666667,           0,           0,           0,           0,           0},
    	.sec_line_offset     = {   128.44444,   57.363636,  -43.733333,           0,           0,           0,           0,           0},
    	.sec_line_sqrtk2add1 = {  0.96351791,  0.80873608,  0.61964429,           0,           0,           0,           0,           0},
    	.center_line_slope   = {        -3.6, -0.78947368,           0,           0,           0,           0,           0},
    	.center_line_offset  = {         555,   231.78947,           0,           0,           0,           0,           0},
    	.lower_line_slope    = {  -3.1151006,  -1.1674084,           0,           0,           0,           0,           0},
    	.lower_line_offset   = {   452.62458,   252.26751,           0,           0,           0,           0,           0},
    	.upper_line_slope    = {  -1.5813876, -0.74545997,           0,           0,           0,           0,           0},
    	.upper_line_offset   = {   350.86602,   244.59368,           0,           0,           0,           0,           0},
    	.corner_limit        = {   95.547231,   154.98534,   119.63518,   161.67644,   121.60711,   110.30234,   143.29466,   137.77324},
    },
};

const _Sensor_AE ov9734_ae_init = 
{
	// 当前sensor 一个frame的最大高度
    .max_frame_length      = 736,	
	// 当前sensor 一个frame的最大高度 避免调整行数导致帧率变化
    .min_frame_vb          = 1,
	// sensor模拟增益最大值
    .max_analog_gain       = 14<<8,
    .min_analog_gain       = 1<<8,
    .default_exposure_line = 735,

    .max_exposure_line     = 735,
    .min_exposure_line     = 4,
	// 1000000/frame_length/fps
    .row_time_us           = 120,
	// ae生效时间 最小值2
    .expo_frame_interval   = 2,
    .to_day_bv             = 962,       // 10lux
    .to_night_bv           = 465,
    .dark_scene_target_lut = {35, 54},
    .dark_scene_bv_lut     = {34, 280},
    .hs_scene_limit_lut    = {55, 75},
    .hs_scene_bv_lut       = {280, 3534},
    .lowlight_lsb_bv_lut   = {34, 115, 222, 400, 791, 1599, 3534,  1e30},
    .lowlight_lsb_gain_lut = {64, 32,  20,   16,  16,  16,   16,   16},  // u7.4
	//.lowlight_lsb_gain_lut = {64, 64,  64,   64,  64,  64,   64,   64},	//BLC
};

// 1.0 - 0.01lux TBD
const _Sensor_BV2NR ov9734_bv2nr_init[BV2RAWNR_ARRAY_NUM] = {
    //           ev, bnr_range_weight_index, bnr_invksigma, bnr_intensity_threshold, yuvnr_idx, csupp_idx,  h264_3dnr_lev, h264_3dnr_en
    {      29491,                     6 ,           511,                      63,         0,         0,         0,              0},    // 320lux
    {       3534,                     8 ,           407,                      63,         0,         0,         1,              1},    // 40lux
    {       1599,                     8 ,           271,                      63,         1,         0,         1,              1},    // 20lux
    {        791,                     16,           271,                      63,         1,         1,         2,              1},    // 10lux
    {        222,                     16,           135,                      48,         2,         1,         2,              1},    // 5p03lux
    {        115,                     16,           135,                      48,         2,         1,         2,              1},    // 2p5lux
    {         57,                     20,           101,                      32,         3,         1,         2,              1},    // 1p25lux
    {         34,                     24,            62,                      32,         4,         1,         2,              1},    // 0p62lux
    {         26,                     26,            50,                      32,         4,         1,         2,              1},    // 0p31lux
    {         21,                     28,            40,                      32,         5,         2,         2,              1},    // 0p1lux
    {         16,                     31,            25,                      32,         5,         2,         2,              1},    // 0p01lux
};

const _Sensor_CSUPP ov9734_csupp_init = {
// u8  U_luma_thr_lo, U_luma_slop_lo, U_luma_shfb_lo, U_luma_gmin_lo,
// u8  U_luma_thr_hi, U_luma_slop_hi, U_luma_shfb_hi, U_luma_gmin_hi,
// u8  V_luma_thr_lo, V_luma_slop_lo, V_luma_shfb_lo, V_luma_gmin_lo,
// u8  V_luma_thr_hi, V_luma_slop_hi, V_luma_shfb_hi, V_luma_gmin_hi,
// u8  chroma_thr_lo, chroma_slop_lo, chroma_shfb_lo, chroma_gmin_lo,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
};

const _Sensor_SHARP ov9734_sharp_init = {
    128 , //smooth_filt_alpha
    0   , //shrink_thr
    127 , //filt_clip_hi
    127 , //filt_clip_lo
    
    20  , //sp_thr2
    10  , //sp_thr1
    127 , //enha_clip_hi
    127 , //enha_clip_lo
    
    8   ,16  ,32  ,     // e1,e2,e3
    0   ,32  ,64  ,128, // k0,k1,k2,k3
    0   ,               // y1 = k0*e1
    8   ,               // y2 = k1*e2 + (y1 - k1*e1) = k1 * (e2 - e1) + y1
    40  ,               // y3 = k2*e3 + (y2 - k2*e2) = k2 * (e3 - e2) + y2

    // --- Unsharp Mask ---
     7   ,9   ,10   , //filt_w11,filt_w12,filt_w13
     9   ,11  ,12   , //filt_w21,filt_w22,filt_w23
    10   ,12  ,24   , //filt_w31,filt_w32,filt_w33
    1   , //filt_type
    8   , //filt_sbit
    1   , //lpf scale

    // --- Sharpen Mask --- 
    // -2  ,  -12,  -19  , //filt_w11,filt_w12,filt_w13
    // -12 ,  -24,  20   , //filt_w21,filt_w22,filt_w23
    // -19 ,  20 ,  196  , //filt_w31,filt_w32,filt_w33
    // 0   , //filt_type 
    // 8   , //filt_sbit
    // 0   , //lpf scale

    // 0   ,  0  ,  -1  , //filt_w11,filt_w12,filt_w13
    // 0   ,  -1 ,  -2  , //filt_w21,filt_w22,filt_w23
    // -1  ,  -2 ,  16  , //filt_w31,filt_w32,filt_w33
    // 0   , //filt_type 
    // 4   , //filt_sbit
    // 0   , //lpf scale

    {16,  255},  // strength lut
    {791, 9930}, // strength bv lut
};

const _Sensor_YUVNR ov9734_yuvnr_init = {
    20,20,20,20,20,20,20,20,
    205,255,0,
};

const _Sensor_COLENH ov9734_colenh_init = {
    .yuv_range  = 0,
    .luma       = 50, // range: 0 ~ 100
    .contrast   = 50, // range: 0 ~ 100
    .saturation = 65, // range: 0 ~ 100
    .hue        = 0, // range: -180 ~ 180
    .ce_in_ofs_y   = 128,
    .ce_in_ofs_cb  = 128,
    .ce_in_ofs_cr  = 128, // range: -128 ~ 128
    .ce_out_ofs_y  = 128, 
    .ce_out_ofs_cb = 128, 
    .ce_out_ofs_cr = 128, // range: -128 ~ 128
    .adj_sat_by_bv = 1,
    .hi_sat     = 65,
    .lo_sat     = 50,
    .hi_sat_bv  = 4531, // high brightness for saturation
    .lo_sat_bv  = 400,  // low brightness for saturation
};

const uint32 ov9734_lsc_tbl[] = {
// R channel
0x00079234, 0x0005FDA1, 0x00054564, 0x0004ED42, 0x0004E137, 0x00052141, 0x00058955, 0x0006A17A, 0x00000200, 0x000699E2, 0x00058D7E, 0x0004ED4C, 0x0004C133, 0x0004A529, 0x0004CD2A, 0x00053540, 
0x00060163, 0x000001AE, 0x0005F5A3, 0x0005115E, 0x00049D33, 0x00046D20, 0x00045D17, 0x00047518, 0x0004D928, 0x00058147, 0x0000017A, 0x0005A176, 0x0004C94B, 0x00045D22, 0x00042D0E, 0x00041D09, 
0x00043905, 0x00049917, 0x00052535, 0x00000162, 0x00055D6B, 0x0004913A, 0x00042D17, 0x00041505, 0x00041102, 0x00041906, 0x00046D0D, 0x0004E928, 0x00000151, 0x0005255B, 0x0004712F, 0x0004210F, 
0x00041103, 0x00040100, 0x00040500, 0x00043907, 0x0004B91D, 0x00000142, 0x0004F952, 0x00045525, 0x00041108, 0x00040502, 0x00040100, 0x00040900, 0x00041D04, 0x0004A516, 0x00000142, 0x0004F151, 
0x00044D24, 0x00040905, 0x00040902, 0x0003FD01, 0x00040900, 0x00042103, 0x0004A512, 0x00000140, 0x0004F150, 0x00045127, 0x00041509, 0x00040D03, 0x00040D03, 0x00040902, 0x00042104, 0x0004A914, 
0x0000013F, 0x00050D5D, 0x0004692E, 0x0004250C, 0x00040502, 0x000404FF, 0x0003FD01, 0x00043905, 0x0004C51D, 0x00000144, 0x00054D6C, 0x00048136, 0x00043512, 0x00041107, 0x00040903, 0x00041502, 
0x0004550D, 0x0004ED27, 0x00000153, 0x00059580, 0x0004B145, 0x00044D1E, 0x00042D0C, 0x00041509, 0x00043908, 0x00048918, 0x00052D36, 0x00000167, 0x0005E190, 0x0004FD59, 0x0004812E, 0x00043912, 
0x00044110, 0x00046114, 0x0004C523, 0x00057D46, 0x0000017F, 0x000661BE, 0x00055974, 0x0004D542, 0x00047525, 0x00047D1C, 0x0004A923, 0x00052136, 0x0005E160, 0x00000195, 0x00073E23, 0x0005C592, 
0x00052159, 0x0004D13B, 0x0004C933, 0x00050534, 0x00059151, 0x0006757F, 0x000001CE, 0x000916BE, 0x000645C9, 0x0005A179, 0x00053559, 0x0005354B, 0x00058D55, 0x00061570, 0x00075DA9, 0x0000022F, 
0x000BD3A5, 0x00073234, 0x00060998, 0x0005B176, 0x0005AD6B, 0x0005F170, 0x0006B189, 0x000905DD, 0x000002BF,
// Gr channel
0x00078A2A, 0x0005E99C, 0x00057969, 0x00053D54, 0x00052D4B, 0x0005494D, 0x00059158, 0x00064171, 0x000001D5, 0x0006C1E9, 0x0005A982, 0x0005415B, 0x00050947, 0x0004F53D, 0x00051140, 0x00055D4C, 
0x0005D563, 0x00000195, 0x00061DAA, 0x0005616C, 0x0004F948, 0x0004C136, 0x0004AD2C, 0x0004C92D, 0x0005153A, 0x00058552, 0x00000174, 0x0005C587, 0x0005215C, 0x0004B939, 0x00048126, 0x0004711D, 
0x0004891D, 0x0004DD2B, 0x00054D45, 0x00000163, 0x00059575, 0x0004F150, 0x00048D2E, 0x0004511B, 0x00043D10, 0x00045910, 0x0004AD1E, 0x00052139, 0x00000158, 0x0005756E, 0x0004CD46, 0x00046524, 
0x00042911, 0x00041907, 0x00043508, 0x00048915, 0x00050530, 0x00000151, 0x00055D68, 0x0004B941, 0x00044D1E, 0x0004190B, 0x00040D04, 0x00042104, 0x00047110, 0x0004F12A, 0x0000014E, 0x00055967, 
0x0004AD3F, 0x00043D1C, 0x00041106, 0x00040903, 0x00041502, 0x00045D0D, 0x0004ED27, 0x0000014C, 0x00055568, 0x0004AD3F, 0x0004391C, 0x00040905, 0x00040502, 0x00041101, 0x0004610B, 0x0004F129, 
0x0000014F, 0x0005616A, 0x0004B541, 0x0004451D, 0x00040908, 0x00040501, 0x00041D02, 0x0004710F, 0x0005052E, 0x00000153, 0x00058170, 0x0004D54A, 0x00045D24, 0x00041D0D, 0x00041505, 0x00043507, 
0x00049116, 0x00052936, 0x0000015C, 0x0005AD7C, 0x00050553, 0x0004892F, 0x00044517, 0x0004390E, 0x00045D11, 0x0004C122, 0x00055942, 0x0000016A, 0x0005ED98, 0x00053963, 0x0004C13D, 0x00047D26, 
0x0004751C, 0x00049920, 0x00050133, 0x00059551, 0x00000177, 0x000661C7, 0x00058176, 0x00050D50, 0x0004C139, 0x0004BD2E, 0x0004ED33, 0x00055546, 0x0005E566, 0x0000018E, 0x00073A16, 0x0005D994, 
0x00056566, 0x0005194F, 0x00051944, 0x0005454A, 0x0005AD5C, 0x0006597D, 0x000001BB, 0x0008CA9E, 0x000669D1, 0x0005C17F, 0x00058167, 0x00057D5E, 0x0005AD63, 0x00061978, 0x0007399D, 0x00000212, 
0x000AE754, 0x00076231, 0x000625A3, 0x0005E17F, 0x0005E175, 0x0006117B, 0x0006B194, 0x000889D6, 0x00000285,
// Gb channel
0x00078225, 0x0005E99C, 0x00057568, 0x00053D53, 0x0005294A, 0x0005454C, 0x00058D58, 0x00063970, 0x000001D0, 0x0006BDE7, 0x0005A982, 0x00053D5A, 0x00050947, 0x0004F53D, 0x00051140, 0x0005594B, 
0x0005D563, 0x00000195, 0x000619A9, 0x0005616C, 0x0004F948, 0x0004C135, 0x0004AD2C, 0x0004C92D, 0x0005153A, 0x00058552, 0x00000174, 0x0005C586, 0x0005255C, 0x0004B939, 0x00048126, 0x0004711D, 
0x0004891D, 0x0004DD2A, 0x00054D45, 0x00000163, 0x00059174, 0x0004F150, 0x00048D2E, 0x0004511B, 0x00043D10, 0x00045910, 0x0004AD1E, 0x00052139, 0x00000158, 0x0005716D, 0x0004CD46, 0x00046524, 
0x00042911, 0x00041907, 0x00043508, 0x00048915, 0x00050530, 0x00000151, 0x00055D68, 0x0004B941, 0x00044D1E, 0x0004190B, 0x00040D04, 0x00042104, 0x00047110, 0x0004F12A, 0x0000014E, 0x00055566, 
0x0004AD3F, 0x00043D1C, 0x00041107, 0x00040903, 0x00041502, 0x00045D0D, 0x0004ED27, 0x0000014C, 0x00055567, 0x0004AD3F, 0x0004351B, 0x00040905, 0x00040501, 0x00041101, 0x0004610B, 0x0004F129, 
0x0000014F, 0x0005616A, 0x0004B941, 0x0004451D, 0x00040D08, 0x00040501, 0x00041902, 0x0004710F, 0x0005052E, 0x00000153, 0x00058170, 0x0004D549, 0x00045924, 0x00041D0D, 0x00041505, 0x00043507, 
0x00049116, 0x00052936, 0x0000015C, 0x0005A97B, 0x00050153, 0x0004852F, 0x00044117, 0x0004390E, 0x00045D10, 0x0004C121, 0x00055942, 0x0000016A, 0x0005ED97, 0x00053563, 0x0004BD3C, 0x00047926, 
0x0004751B, 0x0004991F, 0x00050132, 0x00059551, 0x00000177, 0x000661C5, 0x00057D76, 0x0005094F, 0x0004C139, 0x0004BD2E, 0x0004ED33, 0x00055545, 0x0005E566, 0x0000018E, 0x00073A13, 0x0005D994, 
0x00056165, 0x0005194F, 0x00051544, 0x0005454A, 0x0005AD5C, 0x0006597C, 0x000001BB, 0x0008C699, 0x000669D1, 0x0005C17F, 0x00057D66, 0x00057D5D, 0x0005AD63, 0x00061978, 0x0007359C, 0x00000211, 
0x000AE34C, 0x00076230, 0x000621A3, 0x0005E17F, 0x0005DD75, 0x0006117B, 0x0006AD93, 0x000885D6, 0x00000282,
// B channel
0x00079243, 0x0005C597, 0x0005415F, 0x0005194A, 0x0005214F, 0x00053550, 0x00059959, 0x00064D72, 0x000001E5, 0x0006ADEE, 0x00057575, 0x0005214D, 0x00050D47, 0x00050143, 0x00051D42, 0x0005594A, 
0x0005D55F, 0x00000194, 0x0005F1A0, 0x00052960, 0x0004ED44, 0x0004C537, 0x0004A92B, 0x0004E131, 0x0005153F, 0x0005614D, 0x0000016C, 0x00058D6F, 0x0004F54E, 0x0004B936, 0x00047924, 0x00045518, 
0x0004891A, 0x0004E92B, 0x00053147, 0x0000015B, 0x00054D65, 0x0004D940, 0x0004812B, 0x00044118, 0x00042D0C, 0x00044D0D, 0x0004B11B, 0x0005213D, 0x00000151, 0x00052D58, 0x0004BD3D, 0x00044D20, 
0x0004210C, 0x00040905, 0x00043505, 0x00048915, 0x00051132, 0x0000014E, 0x00050956, 0x0004B535, 0x0004311A, 0x00040908, 0x0003FD01, 0x00042101, 0x0004690F, 0x0004ED28, 0x00000147, 0x0004F150, 
0x0004A536, 0x00042515, 0x00040502, 0x00040102, 0x00041503, 0x00045109, 0x0004E523, 0x00000143, 0x00050153, 0x0004A536, 0x00041915, 0x0003FD00, 0x00040501, 0x00041505, 0x0004590A, 0x0004F927, 
0x00000147, 0x00051957, 0x0004B538, 0x00042918, 0x00040906, 0x00040502, 0x00041103, 0x0004690C, 0x0004F92B, 0x0000014F, 0x00054163, 0x0004D53F, 0x00044D21, 0x00041D09, 0x00040D04, 0x00042905, 
0x00049517, 0x00050137, 0x00000150, 0x00057172, 0x0004F143, 0x00048130, 0x00043515, 0x00042D0B, 0x00045D0D, 0x0004C123, 0x0005253E, 0x0000015A, 0x0005B18B, 0x00050D52, 0x0004BD38, 0x00046123, 
0x00046519, 0x0004991C, 0x0004F12F, 0x00056548, 0x00000174, 0x000619AD, 0x00053564, 0x0004CD3A, 0x0004A52F, 0x0004A924, 0x0004C92C, 0x00051138, 0x0005A155, 0x00000188, 0x0006CDFA, 0x0005797C, 
0x0004F149, 0x0004C533, 0x0004B12B, 0x0004F12F, 0x00055546, 0x0005FD68, 0x000001AF, 0x00083E72, 0x0005DDB0, 0x00053D61, 0x0004FD44, 0x0004F13C, 0x00052D41, 0x0005B55A, 0x0006BD85, 0x000001FB, 
0x000A6F5C, 0x0006C206, 0x0005957E, 0x00054959, 0x0005414F, 0x0005794D, 0x0006416B, 0x00080DB8, 0x0000025B,
};

const _Sensor_LSC          ov9734_lsc_init = {
    .p_lsc_tbl = (uint32 *)ov9734_lsc_tbl,
};

uint8 ov9734_regValTable[29][13] = {
    // 0x00d0  0x0dc1  0x00b8  0x00b9  0x0155  0x0410  0x0411  0x0412  0x0413  0x0414  0x0415  0x0416  0x0417
    {0x00, 0x00, 0x01, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x10, 0x00, 0x01, 0x0c, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x01, 0x00, 0x01, 0x1a, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x11, 0x00, 0x01, 0x2b, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x02, 0x00, 0x02, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x12, 0x00, 0x02, 0x18, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x03, 0x00, 0x02, 0x33, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x13, 0x00, 0x03, 0x15, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x04, 0x00, 0x04, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x14, 0x00, 0x04, 0xe0, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x05, 0x00, 0x05, 0x26, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x15, 0x00, 0x06, 0x2b, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x44, 0x00, 0x08, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x54, 0x00, 0x09, 0x22, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x45, 0x00, 0x0b, 0x0d, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x55, 0x00, 0x0d, 0x16, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x04, 0x01, 0x10, 0x00, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x14, 0x01, 0x13, 0x04, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x24, 0x01, 0x16, 0x1a, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x34, 0x01, 0x1a, 0x2b, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x44, 0x01, 0x20, 0x00, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x54, 0x01, 0x26, 0x07, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x64, 0x01, 0x2c, 0x33, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x74, 0x01, 0x35, 0x17, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x84, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x94, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x85, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x95, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0xa5, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
};

uint32 ov9734_gainLevelTable[30] = {
    64,
    77,
    92,
    110,
    128,
    154,
    186,
    223,
    269,
    323,
    381,
    457,
    544,
    653,
    762,
    914,
    1078,
    1293,
    1541,
    1849,
    2177,
    2612,
    3136,
    3764,
    4710,
    5652,
    6656,
    7988,
    9474,
    0xffffffff
};

void ov9734_ae_adjust(struct isp_ae_func_cfg *p_cfg)
{
    uint8 index         = 0;
    uint8  *addr        = (uint8 *)p_cfg->data.addr;
	
    addr[index++] = 0x35;
    addr[index++] = 0x00;
    addr[index++] = ((p_cfg->exposure_line<<4)>>16) & 0x0f;//p_cfg->exposure_line << ;

    addr[index++] = 0x35;
    addr[index++] = 0x01;
    addr[index++] = ((p_cfg->exposure_line<<4)>>8) & 0xff;//p_cfg->exposure_line;
    addr[index++] = 0x35;
    addr[index++] = 0x02;
    addr[index++] = (p_cfg->exposure_line<<4) & 0xf0;
    addr[index++] = 0x35;
    addr[index++] = 0x0b;
    addr[index++] = (p_cfg->analog_gain) >> 4;
    p_cfg->data.size = index;
    p_cfg->cmd_len   = 2+1;
}


const _Sensor_ISP_Init ov9734_isp_init = 
{
    .type         = ISP_INPUT_DAT_SRC_MIPI0,
    .pixel_h      = 720,
    .pixel_w      = 720,
    .bayer_patten = ISP_BAYER_FORMAT_BGGR,
    .input_format = ISP_INPUT_DAT_FORMAT_RAW10,
    .adjust_func  = (isp_ae_func     )ov9734_ae_adjust,
    .p_blc        = (_Sensor_BLC    *)&ov9734_blc_init,
    .p_ccm        = (_Sensor_CCM    *)&ov9734_ccm_init,
    .p_awb        = (_Sensor_AWB    *)&ov9734_awb_init,
    .p_ae         = (_Sensor_AE     *)&ov9734_ae_init,
    .p_csupp      = (_Sensor_CSUPP  *)&ov9734_csupp_init,
    .p_sharp      = (_Sensor_SHARP  *)&ov9734_sharp_init,
    .p_yuvnr      = (_Sensor_YUVNR  *)&ov9734_yuvnr_init,    
    .p_colenh     = (_Sensor_COLENH *)&ov9734_colenh_init,
    .p_bv2nr      = (_Sensor_BV2NR  *)ov9734_bv2nr_init,    
    .p_lsc        = (_Sensor_LSC    *)&ov9734_lsc_init,
};

SENSOR_OP_SECTION const _Sensor_Adpt_ ov9734_cmd = 
{
	.typ = 1, //YUV
	.pixelw = 720,
	.pixelh= 720,
	.hsyn = 1,
	.vsyn = 1,
	.rduline = 0,//
	.rawwide = 1,//10bit
	.colrarray = 2,//0:_RGRG_ 1:_GRGR_,2:_BGBG_,3:_GBGB_
	.init = (uint8 *)OV9734InitTable,
    .init_len = sizeof(OV9734InitTable),
    .mipi_lane_num = 1,
	.rotate_adapt = {0},
	//.hvb_adapt = {0x6a,0x12,0x6a,0x12},
	. mclk = 24000000,
	.p_fun_adapt = {NULL,NULL,NULL},
	.sensor_isp = (_Sensor_ISP_Init *)&ov9734_isp_init,
};



const _Sensor_Ident_ ov9734_init =
{
	0x34, 0x6c, 0x6d, 0x02, 0x01, 0x300b
	// 0x34, 0x20, 0x21, 0x02, 0x01, 0x300b
};


#endif

