#include "sys_config.h"
#include "typesdef.h"
#include "lib/video/dvp/cmos_sensor/csi.h"
#include "tx_platform.h"
#include "list.h"
#include "dev.h"
#include "hal/isp.h"

/* lens & sensor config information:
- sensor      : gc1054
- fstop       : TBD
- mclk        : 24MHz
- max FPS     : 24
- frame length: TBD
- usage       : TBD
- interface   : mipi 1 lane
- mipi_rate   = 360Mbps/lane 
*/


#if DEV_SENSOR_GC1054

SENSOR_INIT_SECTION const unsigned char GC1054InitTable[CMOS_INIT_LEN]=
{
    //Mclk=24Mhzï¼Œmipidate=360 FPS=24
    //HD=2500/2000,VD=750,row_time=HD/PCLK=55.56us
    //Actual_window_size=1280*720
    //pattern:rggb
    /////////////////////////////////////////////////////
    //////////////////////   SYS   //////////////////////
    /////////////////////////////////////////////////////
    0xf2,0x00,
    0xf6,0x00,
    0xfc,0x04,
    0xf7,0x01,
    0xf8,0x0e,
    0xf9,0x06,
    0xfa,0x80,
    0xfc,0x0e,
    //////////////////////////////////////////
    /////   ANALOG & CISCTL   ////////////////
    //////////////////////////////////////////
    0xfe,0x00,
    0x03,0x02, 
    0x04,0xa6, 
    0x05,0x03,//HB=856-25fps//906-24fps
    0x06,0x8a,
    0x07,0x00, //VB=10
    0x08,0x0a, 
    0x09,0x00,
    0x0a,0x04, //row start
    0x0b,0x00,
    0x0c,0x00, //col start
    0x0d,0x02, 
    0x0e,0xd4, //height 724
    0x0f,0x05, 
    0x10,0x08, //width 1288
    0x17,0xc0,
    0x18,0x02,
    0x19,0x08,
    0x1a,0x18,
    0x1d,0x12,
    0x1e,0x50,
    0x1f,0x80,
    0x21,0x30,
    0x23,0xf8,
    0x25,0x10,
    0x28,0x20,
    0x34,0x0a,//data low
    0x3c,0x10,
    0x3d,0x0e,
    0xcc,0x8e,
    0xcd,0x9a,
    0xcf,0x70,
    0xd0,0xa9,
    0xd1,0xc5,
    0xd2,0xed, //data high
    0xd8,0x3c, //dacin offset
    0xd9,0x7a,
    0xda,0x12,
    0xdb,0x50,
    0xde,0x0c,
    0xe3,0x60,
    0xe4,0x78,
    0xfe,0x01,
    0xe3,0x01,
    0xe6,0x10, //ramps offset
    //////////////////////////////////////////
    ///////////   ISP   //////////////////////
    //////////////////////////////////////////
    0xfe,0x01,
    0x80,0x50,
    0x88,0x73,
    0x89,0x03,
    0x90,0x01, 
    0x92,0x02, //crop win 2<=y<=4
    0x94,0x03, //crop win 2<=x<=5
    0x95,0x02, //crop win height
    0x96,0xd0,
    0x97,0x05, //crop win width
    0x98,0x00,
    //////////////////////////////////////////
    ///////////   BLK   //////////////////////
    //////////////////////////////////////////
    0xfe,0x01,
    0x40,0x22,
    0x43,0x03,
    0x4e,0x3c,
    0x4f,0x00,
    0x60,0x00,
    0x61,0x80,
    //////////////////////////////////////////
    ///////////   GAIN   /////////////////////
    //////////////////////////////////////////
    0xfe,0x01,
    0xb0,0x48,
    0xb1,0x01, 
    0xb2,0x00, 
    0xb6,0x00, 
    0xfe,0x02,
    0x01,0x00,
    0x02,0x01,
    0x03,0x02,
    0x04,0x03,
    0x05,0x04,
    0x06,0x05,
    0x07,0x06,
    0x08,0x0e,
    0x09,0x16,
    0x0a,0x1e,
    0x0b,0x36,
    0x0c,0x3e,
    0x0d,0x56,
    0xfe,0x02,
    0xb0,0x00, //col_gain[11:8]
    0xb1,0x00,
    0xb2,0x00,
    0xb3,0x11,
    0xb4,0x22,
    0xb5,0x54,
    0xb6,0xb8,
    0xb7,0x60,
    0xb9,0x00, //col_gain[12]
    0xba,0xc0,
    0xc0,0x20, //col_gain[7:0]
    0xc1,0x2d,
    0xc2,0x40,
    0xc3,0x5b,
    0xc4,0x80,
    0xc5,0xb5,
    0xc6,0x00,
    0xc7,0x6a,
    0xc8,0x00,
    0xc9,0xd4,
    0xca,0x00,
    0xcb,0xa8,
    0xcc,0x00,
    0xcd,0x50,
    0xce,0x00,
    0xcf,0xa1,
    //////////////////////////////////////////
    /////////   DARKSUN   ////////////////////
    //////////////////////////////////////////
    0xfe,0x02,
    0x54,0xf7,
    0x55,0xf0,
    0x56,0x00,
    0x57,0x00,
    0x58,0x00,
    0x5a,0x04,
    //////////////////////////////////////////
    ////////////   DD   //////////////////////
    //////////////////////////////////////////
    0xfe,0x04,
    0x81,0x8a,
    //////////////////////////////////////////
    ///////////	 MIPI	/////////////////////
    //////////////////////////////////////////
    0xfe,0x03,
    0x01,0x03,
    0x02,0x11,
    0x03,0x20, // 0x03,0x90
    0x10,0x90,
    0x11,0x2b,
    0x12,0x40, //lwc 1280*5/4
    0x13,0x06,
    0x15,0x05, //
    0x21,0x02,
    0x22,0x02,
    0x23,0x08,
    0x24,0x02,
    0x25,0x10,
    0x26,0x04,
    0x29,0x02,
    0x2a,0x02,
    0x2b,0x04,
    0xfe,0x00,
    0xff,0xff
};

const _Sensor_CCM gc1054_ccm_init = {
    // 5000k gamma2.2
#if 0
    428,	-71,	2,
    -190,	401,    -204,
    18,	    -74,	458,
    0,        0,       0,
#else
	346,  -70,  -8,
	-145,  347,-159,
	1,  -63, 379,
	0,    0,   0,
#endif
};

const _Sensor_BLC gc1054_blc_init =
{
    // 17*16, 17*16, 17*16, 17*16,
    // 17*16, 17*16, 17*16, 17*16,
    // 259, 259, 259, 259,
    256, 256, 256, 256,
    // 260, 260, 260, 260,
    // 260, 260, 260, 260,
    // 257, 257, 257, 257, 
    // 259, 259, 259, 259,
};

const _Sensor_AWB gc1054_awb_init = 
{
    .default_gain   = {427,256,256,447},
    .awb_min_gain   = {260,256,256,360},
    .awb_max_gain   = {551,256,256,768},

    .coarse_constraint = {
        .coarse_min_bg =  60,
        .coarse_lb_bg  = 110,
        .coarse_rt_bg  = 120,
        .coarse_max_bg = 200,
        .coarse_min_rg = 100,
        .coarse_lb_rg  = 160,
        .coarse_rt_rg  = 160,
        .coarse_max_rg = 270,   
    },

    .constraint = {
        .section_num = 5,      
        .color_temp = { 7500, 6500, 5000, 4000, 2856, 0, 0, 0},
        .sec_line_slope = {0.13043478,0.57894737,1.33333333,1.44897959,1.47058824, 0, 0, 0},
        .sec_line_offset = {163.17391304,80.57894737,-59.33333333,-122.22448980,-233.47058824, 0, 0, 0},
        .sec_line_sqrtk2add1 = {0.99160041,0.86542629,0.60000000,0.56800381,0.56231002, 0, 0, 0},
        .center_line_slope = {-7.66666667,-0.78947368,-0.71428571,-0.68000000, 0, 0, 0},
        .center_line_offset = {1169.00000000,261.21052632,249.85714286,243.96000000, 0, 0, 0},
        .lower_line_slope = {14.39078405,-2.25188242,-0.71452001,-0.28621527, 0, 0, 0},
        .lower_line_offset = {-1563.28659702,417.50036139,213.03116117,146.66110778, 0, 0, 0},
        .upper_line_slope = {-2.76616134,-0.70016780,-0.71416035,-0.80835805, 0, 0, 0},
        .upper_line_offset = {565.55747149,266.02684729,268.26565555,285.27022947, 0, 0, 0},
        .corner_limit = {121.06719671,178.96528653,138.91600411,181.29339184,216.37689979,84.73073498,227.62310021,101.26926502},
    },
};

const _Sensor_AE gc1054_ae_init = 
{
    .max_frame_length      = 749,
    .min_frame_vb          = 1,
    // .max_analog_gain       = (32<<8),
    .max_analog_gain       = (16<<8),
    .min_analog_gain       =  1<<8,
    .default_exposure_line = 0x2de,//0x2de,
    .max_exposure_line     = 749, //749,
    .min_exposure_line     = 1,
    .row_time_us           = 67,
    .expo_frame_interval   = 3,    
    .to_day_bv             = 787,
    .to_night_bv           = 195,
    .dark_scene_target_lut = {35, 55},
    .dark_scene_bv_lut     = {47, 787},
    .hs_scene_limit_lut    = {55, 85},
    .hs_scene_bv_lut       = {787, 13078},
    .lowlight_lsb_bv_lut   = {47, 94, 195, 381, 781, 1636, 3225, 1e30},
    .lowlight_lsb_gain_lut = {16, 16,  16,  16,  16,   16,   16,   16},  // u7.4
};

const _Sensor_CSUPP gc1054_csupp_init = {
// uint8  U_luma_thr_lo, U_luma_slop_lo, U_luma_shfb_lo, U_luma_gmin_lo,
// uint8  U_luma_thr_hi, U_luma_slop_hi, U_luma_shfb_hi, U_luma_gmin_hi,
// uint8  V_luma_thr_lo, V_luma_slop_lo, V_luma_shfb_lo, V_luma_gmin_lo,
// uint8  V_luma_thr_hi, V_luma_slop_hi, V_luma_shfb_hi, V_luma_gmin_hi,
// uint8  chroma_thr_lo, chroma_slop_lo, chroma_shfb_lo, chroma_gmin_lo,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
};

const _Sensor_SHARP gc1054_sharp_init = {
#if 0
    128 , //smooth_filt_alpha
     0  , //shrink_thr
     60 , //filt_clip_hi
    127 , //filt_clip_lo
    
    10  , //sp_thr2
    5   , //sp_thr1
     60 , //enha_clip_hi
    127 , //enha_clip_lo
    
   10   ,15  ,20  ,//e1,e2,e3
    0   ,64  , 64 , 64 ,//k0,k1,k2,k3
    0   ,10  ,20  ,//y1,y2,y3
    
   -6   ,-3  ,-1  , //filt_w11,filt_w12,filt_w13
   -3   ,3   ,7   , //filt_w21,filt_w22,filt_w23
   -1   ,7   ,12  , //filt_w31,filt_w32,filt_w33
    
    0   , //filt_type
    4   , //filt_sbit
    0   , // lpf scale
#else
    128 , //smooth_filt_alpha
    0   , //shrink_thr
    127 , //filt_clip_hi
    127 , //filt_clip_lo
    
    10  , //sp_thr2
    5   , //sp_thr1
     30 , //enha_clip_hi
    127 , //enha_clip_lo
    
    5   ,10  ,15  ,//e1,e2,e3
    0   ,128 ,128 ,128,//k0,k1,k2,k3
    0   ,20  ,40  ,//y1,y2,y3
    
    7   ,9   ,10   , //filt_w11,filt_w12,filt_w13
    9   ,12  ,13   , //filt_w21,filt_w22,filt_w23
   10   ,13  ,16   , //filt_w31,filt_w32,filt_w33
    
    1   , //filt_type
    8   , //filt_sbit
    1   , //lpf scale
#endif
};

const _Sensor_YUVNR gc1054_yuvnr_init = {
    20,20,20,20,20,20,20,20,
    205,255,0,
};

const _Sensor_COLENH gc1054_colenh_init = {
    .luma       = 50, // range: 0 ~ 100
    .contrast   = 50, // range: 0 ~ 100
    .saturation = 70, // range: 0 ~ 100
    .hue        = 0, // range: -180 ~ 180
    .ce_in_ofs_y   = 128,
    .ce_in_ofs_cb  = 128,
    .ce_in_ofs_cr  = 128, // range: -128 ~ 128
    .ce_out_ofs_y  = 128, 
    .ce_out_ofs_cb = 128, 
    .ce_out_ofs_cr = 128, // range: -128 ~ 128
    .adj_sat_by_bv = 1,
    .hi_sat     = 70,
    .lo_sat     = 50,
    .hi_sat_bv  = 1638, // high brightness for saturation
    .lo_sat_bv  = 381, // low brightness for saturation
};

const _Sensor_BV2NR gc1054_bv2nr_init[11] = {
    //           bv, bnr_range_weight_index, bnr_invksigma, bnr_intensity_threshold, yuvnr_idx, csupp_idx
#if 0
    {            46,                      0,             0,                       0,         0,         0},    // 646lux
    {           124,                     15,           407,                      45,         0,         0},    // 240lux
    {          1469,                     15,           407,                      45,         0,         0},    // 20lux
    {          2959,                     15,           244,                      45,         0,         0},    // 10lux
    {          5906,                     17,           244,                      45,         1,         0},    // 5p03lux
    {         11864,                     17,           122,                      35,         2,         1},    // 2p5lux
    {         23752,                     17,            81,                      35,         2,         2},    // 1p25lux
    {         47277,                     19,            48,                      35,         3,         2},    // 0p62lux
    {         94554,                     19,            48,                      35,         3,         2},    // 0p31lux
    {        283662,                     19,            48,                      35,         4,         2},    // 0p1lux
    {       2836620,                     32,            40,                      35,         5,         2},    // 0p01lux
#else
    {        25669,                      0,             0,                       0,         0,         0},    // 646lux
    {         1636,                      0,             0,                       0,         0,         0},    // 240lux
    {          787,                      4,           407,                      20,         0,         0},    // 20lux
    {          381,                      4,           407,                      20,         0,         0},    // 10lux
    {          195,                      4,           244,                      35,         1,         0},    // 5p03lux
    {           94,                      8,           244,                      35,         2,         1},    // 2p5lux
    {           47,                      8,           244,                      35,         2,         1},    // 1p25lux
    {           30,                     19,            48,                      35,         3,         1},    // 0p62lux
    {           20,                      0,             0,                       0,         0,         2},    // 0p31lux
    {           16,                      0,             0,                       0,         0,         2},    // 0p1lux
    {           16,                      0,             0,                       0,         0,         2},    // 0p01lux
#endif
//    {         47277,                     15,           244,                      45,         0,         2},    // 10lux
//    {         94554,                     15,           244,                      45,         0,         2},    // 10lux
//    {        283662,                     15,           244,                      45,         0,         2},    // 10lux
//    {       2836620,                     15,           244,                      45,         0,         2},    // 10lux
};
const uint32 gc1054_lsc_tbl[] = {
//R channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//GR channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//GB channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//B channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
};

const _Sensor_LSC          gc1054_lsc_init = {
    .p_lsc_tbl = (uint32 *)gc1054_lsc_tbl,
};
uint8 gc1054_regValTable[25][6] = {
    // 00d1  00d0  0dc1  00b8  00b9  0155 
    {  0x00, 0x00, 0x00, 0x01, 0x00, 0x00},
    {  0x0A, 0x00, 0x00, 0x01, 0x0c, 0x00},
    {  0x00, 0x01, 0x00, 0x01, 0x1a, 0x00},
    {  0x0A, 0x01, 0x00, 0x01, 0x2a, 0x00},
    {  0x00, 0x02, 0x00, 0x02, 0x00, 0x00},
    {  0x0A, 0x02, 0x00, 0x02, 0x18, 0x00},
    {  0x00, 0x03, 0x00, 0x02, 0x33, 0x00},
    {  0x0A, 0x03, 0x00, 0x03, 0x14, 0x00},
    {  0x00, 0x04, 0x00, 0x04, 0x00, 0x02},
    {  0x0A, 0x04, 0x00, 0x04, 0x2f, 0x02},
    {  0x00, 0x05, 0x00, 0x05, 0x26, 0x02},
    {  0x0A, 0x05, 0x00, 0x06, 0x29, 0x02},
    {  0x00, 0x06, 0x00, 0x08, 0x00, 0x02},
    {  0x0A, 0x06, 0x00, 0x09, 0x1f, 0x04},
    {  0x12, 0x46, 0x00, 0x0b, 0x0d, 0x04},
    {  0x19, 0x66, 0x00, 0x0d, 0x12, 0x06},
    {  0x00, 0x04, 0x01, 0x10, 0x00, 0x06},				
    {  0x0A, 0x04, 0x01, 0x12, 0x3e, 0x08},
    {  0x00, 0x05, 0x01, 0x16, 0x1a, 0x0a},
    {  0x0A, 0x05, 0x01, 0x1a, 0x23, 0x0c},
    {  0x00, 0x06, 0x01, 0x20, 0x00, 0x0c},
    {  0x0A, 0x06, 0x01, 0x25, 0x3b, 0x0f},
    {  0x12, 0x46, 0x01, 0x2c, 0x33, 0x12},
    {  0x19, 0x66, 0x01, 0x35, 0x06, 0x14},
    {  0x20, 0x06, 0x01, 0x3f, 0x3f, 0x15},
};

uint32 gc1054_gainLevelTable[26] = {
    64,  
    76,  
    90,  
    106, 
    128, 
    152, 
    
    179,
    212, 
    256, 
    303, 
    358, 
    425, 
    
    512, 
    607, 
    717, 
    849, 
        
    1024,
    1213,
    1434,
    1699,
    2048,			
    2427,
    2867,
    3398,
    4096,							
    0xffffffff,
};

void gc1054_ae_adjust(struct isp_ae_func_cfg *p_cfg)
{
#if 1
    uint32 i            = 0;
    uint32 index        = 0;
    uint32 total        = sizeof(gc1054_gainLevelTable) / sizeof(uint32);
    uint32 tol_dig_gain = 0;
    uint32 gain         = p_cfg->analog_gain >> 2;
    uint8  *addr        = (uint8 *)p_cfg->data.addr;

    for(i = 0; i < total; i++)
    {
        if((gc1054_gainLevelTable[i] <= gain)&&(gain < gc1054_gainLevelTable[i+1]))
            break;
    }

    tol_dig_gain = (gain)*64/gc1054_gainLevelTable[i];

    addr[index++] = 0xb0;
    addr[index++] = gc1054_regValTable[i][0];
    addr[index++] = 0x00;
    addr[index++] = 0xd0;
    addr[index++] = gc1054_regValTable[i][1];
    addr[index++] = 0x03;
    addr[index++] = 0x1d;
    addr[index++] = 0x2e;
    addr[index++] = 0x0d;
    addr[index++] = 0xc1;
    addr[index++] = gc1054_regValTable[i][2];
    addr[index++] = 0x03;
    addr[index++] = 0x1d;
    addr[index++] = 0x28;
    addr[index++] = 0x00;
    addr[index++] = 0xb8;
    addr[index++] = gc1054_regValTable[i][3];
    addr[index++] = 0x00;
    addr[index++] = 0xb9;
    addr[index++] = gc1054_regValTable[i][4];
    addr[index++] = 0x01;
    addr[index++] = 0x55;
    addr[index++] = gc1054_regValTable[i][5];
    addr[index++] = 0x00;
    addr[index++] = 0xb1;
    addr[index++] = (uint8)(tol_dig_gain>>6);
    addr[index++] = 0x00;
    addr[index++] = 0xb2;
    addr[index++] = (uint8)((tol_dig_gain&0x3f)<<2);
    addr[index++] = 0x0d;
    addr[index++] = 0x03;
    addr[index++] = (uint8)(p_cfg->exposure_line >> 8);
    addr[index++] = 0x0d;
    addr[index++] = 0x04;
    addr[index++] = (p_cfg->exposure_line & 0xff);
    p_cfg->data.size = index;
    p_cfg->cmd_len   = 1+1;
#endif
}

const _Sensor_ISP_Init gc1054_isp_init = 
{
    .type         = ISP_INPUT_DAT_SRC_MIPI0,
    .pixel_h      = 720,
    .pixel_w      = 1280,
    .bayer_patten = ISP_BAYER_FORMAT_RGGB,
    .input_format = ISP_INPUT_DAT_FORMAT_RAW10,
   #if 1
    .adjust_func  = (isp_ae_func     )gc1054_ae_adjust,
    .p_blc        = (_Sensor_BLC    *)&gc1054_blc_init,
    .p_ccm        = (_Sensor_CCM    *)&gc1054_ccm_init,
    .p_awb        = (_Sensor_AWB    *)&gc1054_awb_init,
    .p_ae         = (_Sensor_AE     *)&gc1054_ae_init,
    .p_csupp      = (_Sensor_CSUPP  *)&gc1054_csupp_init,
    .p_sharp      = (_Sensor_SHARP  *)&gc1054_sharp_init,
    .p_yuvnr      = (_Sensor_YUVNR  *)&gc1054_yuvnr_init,    
    .p_colenh     = (_Sensor_COLENH *)&gc1054_colenh_init,	
    .p_bv2nr      = (_Sensor_BV2NR  *)gc1054_bv2nr_init,
    .p_lsc        = (_Sensor_LSC    *)&gc1054_lsc_init,
   #endif
};


SENSOR_OP_SECTION const _Sensor_Adpt_ gc1054_cmd = 
{
	.typ = 1, //YUV
	.pixelw = 1280,
	.pixelh= 720,
	.hsyn = 1,
	.vsyn = 1,
	.rduline = 0,//
	.rawwide = 1,//10bit
	.colrarray = 1,//0:_RGRG_ 1:_GRGR_,2:_BGBG_,3:_GBGB_
	.init = (uint8 *)GC1054InitTable,
    .init_len = sizeof(GC1054InitTable),
    .mipi_lane_num = 1,
	.rotate_adapt = {0},
	//.hvb_adapt = {0x6a,0x12,0x6a,0x12},
	. mclk = 24000000,
	.p_fun_adapt = {NULL,NULL,NULL},
    .sensor_isp = (_Sensor_ISP_Init *)&gc1054_isp_init,
};

const _Sensor_Ident_ gc1054_init =
{
	0x54, 0x42, 0x43, 0x01, 0x01, 0xf1
};
#endif

