#include "sys_config.h"
#include "typesdef.h"
#include "lib/video/dvp/cmos_sensor/csi.h"
#include "tx_platform.h"
#include "list.h"
#include "dev.h"
#include "hal/isp.h"

/* lens & sensor config information:
- sensor      : gc2083
- fstop       : 2.0
- mclk        : 24MHz
- max FPS     : TBD
- frame length: TBD
- usage       : DRI
- interface   : mipi 2 lane
*/

#if DEV_SENSOR_GC2083

SENSOR_INIT_SECTION const unsigned char GC2083InitTable[CMOS_INIT_LEN]=
{
    #if 0 //2 LANE
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0x00,
    0x03, 0xf2, 0x00,
    0x03, 0xf3, 0x00,
    0x03, 0xf4, 0x36,
    0x03, 0xf5, 0xc0,
    0x03, 0xf6, 0x26, 
    0x03, 0xf7, 0x01,
    0x03, 0xf8, 0x3b, 
    0x03, 0xf9, 0x43, 
    0x03, 0xfc, 0x8e, 
    0x03, 0x81, 0x07, 
    0x00, 0xd7, 0x29, 
    0x0d, 0x6d, 0x18, 
    0x00, 0xd5, 0x03, 
    0x00, 0x82, 0x01, 
    0x0d, 0xb3, 0xd4, 
    0x0d, 0xb0, 0x0d, 
    0x0d, 0xb5, 0x96, 
    0x0d, 0x03, 0x02,
    0x0d, 0x04, 0x02,
    0x0d, 0x05, 0x05,       // line length[13:8]
    0x0d, 0x06, 0xb0,       // line length[07:0]
    0x0d, 0x07, 0x00,
    0x0d, 0x08, 0x11,
    0x0d, 0x09, 0x00, 
    0x0d, 0x0a, 0x02, 
    0x00, 0x0b, 0x00, 
    0x00, 0x0c, 0x02, 
    0x0d, 0x0d, 0x04, 
    0x0d, 0x0e, 0x40, 
    0x00, 0x0f, 0x07,
    0x00, 0x10, 0x90,
    0x00, 0x17, 0x0c, 
    0x0d, 0x73, 0x92, 
    0x00, 0x76, 0x00,
    0x0d, 0x76, 0x00,
    0x0d, 0x41, 0x04,  // frame_length
    0x0d, 0x42, 0x65,
    0x0d, 0x7a, 0x10, 
    0x0d, 0x19, 0x31, 
    0x0d, 0x25, 0xcb,
    0x0d, 0x20, 0x60,
    0x0d, 0x27, 0x03,
    0x0d, 0x29, 0x60, 
    0x0d, 0x43, 0x10, 
    0x0d, 0x49, 0x10, 
    0x0d, 0x55, 0x18,
    0x0d, 0xc2, 0x44, 
    0x00, 0x58, 0x3c, 
    0x00, 0xd8, 0x68, 
    0x00, 0xd9, 0x14, 
    0x00, 0xda, 0xc1, 
    0x00, 0x50, 0x18, 
    0x0d, 0xb6, 0x3d, 
    0x00, 0xd2, 0xbc, 
    0x0d, 0x66, 0x42,
    0x00, 0x8c, 0x07, 
    0x00, 0x8d, 0xff, 
    0x00, 0x7a, 0x50, //global gain
    0x00, 0xd0, 0x00, 
    0x0d, 0xc1, 0x00, 
    0x01, 0x02, 0xa9, //89
    0x01, 0x58, 0x00,
    0x01, 0x07, 0xa6,
    0x01, 0x08, 0xa9,
    0x01, 0x09, 0xa8,
    0x01, 0x0a, 0xa7,
    0x01, 0x0b, 0xff,
    0x01, 0x0c, 0xff,
    0x04, 0x28, 0x86,
    0x04, 0x29, 0x86,
    0x04, 0x2a, 0x86,
    0x04, 0x2b, 0x68,
    0x04, 0x2c, 0x68,
    0x04, 0x2d, 0x68,
    0x04, 0x2e, 0x68,
    0x04, 0x2f, 0x68,
    0x04, 0x30, 0x4f,
    0x04, 0x31, 0x68,
    0x04, 0x32, 0x67,
    0x04, 0x33, 0x66,
    0x04, 0x34, 0x66,
    0x04, 0x35, 0x66,
    0x04, 0x36, 0x66,
    0x04, 0x37, 0x66,
    0x04, 0x38, 0x62,
    0x04, 0x39, 0x62,
    0x04, 0x3a, 0x62,
    0x04, 0x3b, 0x62,
    0x04, 0x3c, 0x62,
    0x04, 0x3d, 0x62,
    0x04, 0x3e, 0x62,
    0x04, 0x3f, 0x62,
    0x00, 0x77, 0x01,
    0x00, 0x78, 0x65,
    0x00, 0x79, 0x04,
    0x00, 0x67, 0xa0,
    0x00, 0x54, 0xff,
    0x00, 0x55, 0x02,
    0x00, 0x56, 0x00,
    0x00, 0x57, 0x04,
    0x00, 0x5a, 0xff,
    0x00, 0x5b, 0x07,
    0x00, 0x26, 0x01,
    0x01, 0x52, 0x02,
    0x01, 0x53, 0x50,
    0x01, 0x55, 0x93,
    0x04, 0x10, 0x16,
    0x04, 0x11, 0x16,
    0x04, 0x12, 0x16,
    0x04, 0x13, 0x16,
    0x04, 0x14, 0x6f,
    0x04, 0x15, 0x6f,
    0x04, 0x16, 0x6f,
    0x04, 0x17, 0x6f,
    0x04, 0xe0, 0x18,
    0x01, 0x92, 0x04,
    0x01, 0x94, 0x04, 
    0x01, 0x95, 0x04,
    0x01, 0x96, 0x38, 
    0x01, 0x97, 0x07,
    0x01, 0x98, 0x80, 
    0x02, 0x01, 0x27, 
    0x02, 0x02, 0x53, //0x50 
    0x02, 0x03, 0xce, //0xb6//0x8e
    0x02, 0x04, 0x40,
    0x02, 0x12, 0x07,
    0x02, 0x13, 0x80, 
    0x02, 0x15, 0x12,
    0x02, 0x29, 0x05, 
    0x02, 0x37, 0x03,
    0x02, 0x3e, 0x9b, 
    #elif 0
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0x00,
    0x03, 0xf2, 0x00,
    0x03, 0xf3, 0x00,
    0x03, 0xf4, 0x36,
    0x03, 0xf5, 0xc0,
    0x03, 0xf6, 0x24, 
    0x03, 0xf7, 0x01, 
    0x03, 0xf8, 0x31, 
    0x03, 0xf9, 0x43, 
    0x03, 0xfc, 0xae, 
    0x03, 0x81, 0x07, 
    0x00, 0xd7, 0x17, 
    0x0d, 0x6d, 0x18, 
    0x00, 0xd5, 0x03, 
    0x00, 0x82, 0x01, 
    0x0d, 0xb3, 0xd4, 
    0x0d, 0xb0, 0x0d, 
    0x0d, 0xb5, 0x96, 
    0x0d, 0x03, 0x02,
    0x0d, 0x04, 0x02,
    0x0d, 0x05, 0x07, 
    0x0d, 0x06, 0x2c, 
    0x0d, 0x07, 0x00,
    0x0d, 0x08, 0x11,
    0x0d, 0x09, 0x00, 
    0x0d, 0x0a, 0x02, 
    0x00, 0x0b, 0x00, 
    0x00, 0x0c, 0x02, 
    0x0d, 0x0d, 0x04, 
    0x0d, 0x0e, 0x40, 
    0x00, 0x0f, 0x07,
    0x00, 0x10, 0x90,
    0x00, 0x17, 0x0c, 
    0x0d, 0x73, 0x92, 
    0x00, 0x76, 0x00,
    0x0d, 0x76, 0x00,
    0x0d, 0x41, 0x04, 
    0x0d, 0x42, 0x65,
    0x0d, 0x7a, 0x10, 
    0x0d, 0x19, 0x31, 
    0x0d, 0x25, 0xcb,
    0x0d, 0x20, 0x60,
    0x0d, 0x27, 0x03,
    0x0d, 0x29, 0x60, 
    0x0d, 0x43, 0x10, 
    0x0d, 0x49, 0x10, 
    0x0d, 0x55, 0x18,
    0x0d, 0xc2, 0x44, 
    0x00, 0x58, 0x3c, 
    0x00, 0xd8, 0x68, 
    0x00, 0xd9, 0x14, 
    0x00, 0xda, 0xc1, 
    0x00, 0x50, 0x18, 
    0x0d, 0xb6, 0x3d, 
    0x00, 0xd2, 0xbc, 
    0x0d, 0x66, 0x42,
    0x00, 0x8c, 0x05, 
    0x00, 0x8d, 0xa8, 
    0x00, 0x7a, 0x58, //global gain
    0x00, 0xd0, 0x00, 
    0x0d, 0xc1, 0x00, 
    0x01, 0x02, 0xa9, //89
    0x01, 0x58, 0x00,
    0x01, 0x07, 0xa6,
    0x01, 0x08, 0xa9,
    0x01, 0x09, 0xa8,
    0x01, 0x0a, 0xa7,
    0x01, 0x0b, 0xff,
    0x01, 0x0c, 0xff,
    0x04, 0x28, 0x86,
    0x04, 0x29, 0x86,
    0x04, 0x2a, 0x86,
    0x04, 0x2b, 0x68,
    0x04, 0x2c, 0x68,
    0x04, 0x2d, 0x68,
    0x04, 0x2e, 0x68,
    0x04, 0x2f, 0x68,
    0x04, 0x30, 0x4f,
    0x04, 0x31, 0x68,
    0x04, 0x32, 0x67,
    0x04, 0x33, 0x66,
    0x04, 0x34, 0x66,
    0x04, 0x35, 0x66,
    0x04, 0x36, 0x66,
    0x04, 0x37, 0x66,
    0x04, 0x38, 0x62,
    0x04, 0x39, 0x62,
    0x04, 0x3a, 0x62,
    0x04, 0x3b, 0x62,
    0x04, 0x3c, 0x62,
    0x04, 0x3d, 0x62,
    0x04, 0x3e, 0x62,
    0x04, 0x3f, 0x62,
    0x00, 0x77, 0x01,
    0x00, 0x78, 0x65,
    0x00, 0x79, 0x04,
    0x00, 0x67, 0xa0,
    0x00, 0x54, 0xff,
    0x00, 0x55, 0x02,
    0x00, 0x56, 0x00,
    0x00, 0x57, 0x04,
    0x00, 0x5a, 0xff,
    0x00, 0x5b, 0x07,
    0x00, 0x26, 0x01,
    0x01, 0x52, 0x02,
    0x01, 0x53, 0x50,
    0x01, 0x55, 0x93,
    0x04, 0x10, 0x16,
    0x04, 0x11, 0x16,
    0x04, 0x12, 0x16,
    0x04, 0x13, 0x16,
    0x04, 0x14, 0x6f,
    0x04, 0x15, 0x6f,
    0x04, 0x16, 0x6f,
    0x04, 0x17, 0x6f,
    0x04, 0xe0, 0x18,
    0x01, 0x92, 0x04,
    0x01, 0x94, 0x04, 
    0x01, 0x95, 0x04,
    0x01, 0x96, 0x38, 
    0x01, 0x97, 0x07,
    0x01, 0x98, 0x80, 
    0x02, 0x01, 0x27, 
    0x02, 0x02, 0x53, //0x50 
    0x02, 0x03, 0xce, //0xb6//0x8e
    0x02, 0x04, 0x40,
    0x02, 0x12, 0x07,
    0x02, 0x13, 0x80, 
    0x02, 0x15, 0x12,
    0x02, 0x3e, 0x9a, //bit1 line_sync 
    #else
    //window size:1920x1080
    //mclk=24mhz,mipi_rate=594Mbps/lane   PCLK=118.8M
    //rowtime=29.62963us
    //frame rate:25.51fps,
    //hb=1100,vts=1323, hts=3520
    //bayer mode:RGGB
    /****system****/
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0xf0,
    0x03, 0xfe, 0x00,
    0x03, 0xf2, 0x00,
    0x03, 0xf3, 0x00,
    0x03, 0xf4, 0x36,
    0x03, 0xf5, 0xc0,
    0x03, 0xf6, 0x44,  //24
    0x03, 0xf7, 0x01, 
    0x03, 0xf8, 0x63,  //34
    0x03, 0xf9, 0x41,  //43
    0x03, 0xfc, 0x8e,
    0x03, 0x81, 0x07,
    0x00, 0xd7, 0x29,
    /****CISCTL & ANALOG****/
    0x0d, 0x6d, 0x18, 
    0x00, 0xd5, 0x03, 
    0x00, 0x82, 0x01, 
    0x0d, 0xb3, 0xd4, 
    0x0d, 0xb0, 0x0d, 
    0x0d, 0xb5, 0x96, 
    0x0d, 0x03, 0x02,
    0x0d, 0x04, 0x02,
    0x0d, 0x05, 0x04, 
    0x0d, 0x06, 0x4c,  //hb=1541 //1100
    0x0d, 0x07, 0x00,
    0x0d, 0x08, 0x11,  //17
    0x0d, 0x09, 0x00, 
    0x0d, 0x0a, 0x02, 
    0x00, 0x0b, 0x00, 
    0x00, 0x0c, 0x02, 
    0x0d, 0x0d, 0x04, 
    0x0d, 0x0e, 0x40,  //1088
    0x00, 0x0f, 0x07,
    0x00, 0x10, 0x90,  //1936
    0x00, 0x17, 0x0c, 
    0x0d, 0x73, 0x92, 
    0x0d, 0x76, 0x00,
    0x00, 0x76, 0x00,

    0x0d, 0x41, 0x05, 
    0x0d, 0x42, 0x2b,  //frame length 1125//1323
    0x0d, 0x7a, 0x10, 
    0x0d, 0x19, 0x31, 
    0x0d, 0x25, 0xcb, 
    0x0d, 0x20, 0x60,
    0x0d, 0x27, 0x03,
    0x0d, 0x29, 0x60, 
    0x0d, 0x43, 0x10, 
    0x0d, 0x49, 0x10, 
    0x0d, 0x55, 0x18,
    0x0d, 0xc2, 0x44, 
    0x00, 0x58, 0x3c, 
    0x00, 0xd8, 0x68, 
    0x00, 0xd9, 0x14, 
    0x00, 0xda, 0xc1, 
    0x00, 0x50, 0x18, 
    0x0d, 0xb6, 0x3d, 
    0x00, 0xd2, 0xbc, 
    0x0d, 0x66, 0x42,
    0x00, 0x8c, 0x05,  //07
    0x00, 0x8d, 0xa8, 

    /*gain*/
    0x00, 0x7a, 0x68, //global gain
    0x00, 0xd0, 0x00, 
    0x0d, 0xc1, 0x00, 

    /*isp*/
    0x01, 0x02, 0xa9, //89
    0x01, 0x58, 0x00,
    0x01, 0x07, 0xa6,
    0x01, 0x08, 0xa9,
    0x01, 0x09, 0xa8,
    0x01, 0x0a, 0xa7,
    0x01, 0x0b, 0xff,
    0x01, 0x0c, 0xff,

    0x04, 0x28, 0x86,
    0x04, 0x29, 0x86,
    0x04, 0x2a, 0x86,
    0x04, 0x2b, 0x68,
    0x04, 0x2c, 0x68,
    0x04, 0x2d, 0x68,
    0x04, 0x2e, 0x68,
    0x04, 0x2f, 0x68,

    0x04, 0x30, 0x4f,
    0x04, 0x31, 0x68,
    0x04, 0x32, 0x67,
    0x04, 0x33, 0x66,
    0x04, 0x34, 0x66,
    0x04, 0x35, 0x66,
    0x04, 0x36, 0x66,
    0x04, 0x37, 0x66,

    0x04, 0x38, 0x62,
    0x04, 0x39, 0x62,
    0x04, 0x3a, 0x62,
    0x04, 0x3b, 0x62,
    0x04, 0x3c, 0x62,
    0x04, 0x3d, 0x62,
    0x04, 0x3e, 0x62,
    0x04, 0x3f, 0x62,

    /*dark sun*/
    0x00, 0x77, 0x01,
    0x00, 0x78, 0x65,
    0x00, 0x79, 0x04,
    0x00, 0x67, 0xa0,
    0x00, 0x54, 0xff,
    0x00, 0x55, 0x02,
    0x00, 0x56, 0x00,
    0x00, 0x57, 0x04,
    0x00, 0x5a, 0xff,
    0x00, 0x5b, 0x07,

    /*blk*/
    0x00, 0x26, 0x01,
    0x01, 0x52, 0x02,
    0x01, 0x53, 0x50,
    0x01, 0x55, 0x93,
    0x04, 0x10, 0x16,
    0x04, 0x11, 0x16,
    0x04, 0x12, 0x16,
    0x04, 0x13, 0x16,
    0x04, 0x14, 0x6f,
    0x04, 0x15, 0x6f,
    0x04, 0x16, 0x6f,
    0x04, 0x17, 0x6f,
    0x04, 0xe0, 0x18,

    /*window*/
    0x01, 0x92, 0x04,
    0x01, 0x94, 0x04,
    0x01, 0x95, 0x04,
    0x01, 0x96, 0x38,
    0x01, 0x97, 0x07,
    0x01, 0x98, 0x80,

    /****DVP & MIPI****/
    0x02, 0x01, 0x27, 
    0x02, 0x02, 0x53, //0x50 
    0x02, 0x03, 0xce, //0xb6//0x8e
    0x02, 0x04, 0x40,
    0x02, 0x12, 0x07,
    0x02, 0x13, 0x80, 
    0x02, 0x15, 0x12,
    0x02, 0x29, 0x05, 
    0x02, 0x37, 0x03,
    0x02, 0x3e, 0x99, 
    #endif
    0xff, 0xff, 0xff,
};

const _Sensor_CCM gc2083_ccm_init = {
    // 5500k, gamma2p2
    // 0x17A,  0xfc9,  0xffd,
    // 0xfa4,  0x148,  0xf0b,
    // 0xfe1,  0xfed,  0x1f6,
    // 0x000,  0x000,  0x000,

    // 311,    -130,	-59,
    // 26 ,	509	,   -42,
    // -81, 	-123,	356,
    // 0   ,   0   ,   0  ,

    // (311-256)*0.3+256,   -130     *0.3    ,	-59      *0.3    ,     // 272, -39, -17,
    // 26       *0.3    ,	(509-256)*0.3+256,  -42      *0.3    ,     // 7  , 331, -12,
    // -81      *0.3    , 	-123     *0.3    ,	(356-256)*0.3+256,     // -24, -36, 286,
    // 0                ,   0                ,   0               ,      // 0  , 0  , 0  ,

    269, -59, -17,
    7  , 341, -12,
    -20, -26, 285,
    0  , 0  , 0  ,
};

const _Sensor_BLC gc2083_blc_init =
{
    // 251, 251, 251, 251,
    62<<2, 62<<2, 62<<2, 62<<2,
};

const _Sensor_AWB gc2083_awb_init = 
{
    .default_gain   = {383, 256, 256, 478},
    .awb_min_gain   = {305, 256, 256, 350},
    .awb_max_gain   = {528, 256, 256, 650},

    .coarse_constraint = {
        .coarse_min_bg =  70,
        .coarse_lb_bg  = 100,
        .coarse_rt_bg  = 120,
        .coarse_max_bg = 210,
        .coarse_min_rg = 100,
        .coarse_lb_rg  = 150,
        .coarse_rt_rg  = 145,
        .coarse_max_rg = 270,
    },

    .constraint = {
    //    .section_num = 5,
    //    //   temp:   7500, 6500, 5000, 4000, 2856
    //    //  rgain:    498,  485,  427,  383,  305
    //    //  bgain:    353,  396,  444,  478,  594
    //    // lower,upper range
    //    // lower,upper
    //    //     8,   10
    //    //    15,   15
    //    //    35,   15
    //    //    35,   15
    //    //    15,   15
    //    .color_temp = { 7500, 6500, 5000, 4000, 2856, 0, 0, 0},
    //    .sec_line_slope = {0.14285714, 0.55263158, 1.28571429, 1.63157895, 1.62962963, 0, 0, 0},
    //    .sec_line_offset = {167.14285714, 90.39473684, -48.71428571, -142.00000000, -240.37037037, 0, 0, 0},
    //    .sec_line_sqrtk2add1 = {0.98994949, 0.87524154, 0.61394061, 0.52256206, 0.52301622, 0, 0, 0},
    //    .center_line_slope = {-7.00000000, -0.94444444, -0.61111111, -0.61363636, 0, 0, 0},
    //    .center_line_offset = {1110.00000000, 292.50000000, 241.50000000, 241.93181818, 0, 0, 0},
    //    .lower_line_slope = {12.27867283, -3.87648510, -0.62333997, -0.18264122, 0, 0, 0},
    //    .lower_line_offset = {-1338.67405732, 630.17728510, 202.34940780, 135.05015736, 0, 0, 0},
    //    .upper_line_slope = {-2.43355437, -0.88171731, -0.60443022, -0.61363631, 0, 0, 0},
    //    .upper_line_offset = {532.73434934, 302.86286297, 257.88437005, 259.53077303, 0, 0, 0},
    //    .corner_limit = {124.08040405, 184.86862915, 141.89949494, 187.41421356, 207.15475670, 97.21515907, 222.84524330, 122.78484093},

    //   temp:   6500, 5000, 4000, 2856
    //  rgain:    485,  427,  383,  305
    //  bgain:    396,  444,  478,  594
    // lower,upper range
    // lower,upper
    //    15,   15
    //    35,   15
    //    35,   15
    //    15,   15
        .section_num = 4,
        .color_temp = { 6500, 5000, 4000, 2856, 0, 0, 0, 0},
        .sec_line_slope = {1.05882353, 1.28571429, 1.63157895, 1.62962963, 0, 0, 0, 0},
        .sec_line_offset = {22.05882353, -48.71428571, -142.00000000, -240.37037037, 0, 0, 0, 0},
        .sec_line_sqrtk2add1 = {0.68662353, 0.61394061, 0.52256206, 0.52301622, 0, 0, 0, 0},
        .center_line_slope = {-0.94444444, -0.61111111, -0.61363636, 0, 0, 0, 0},
        .center_line_offset = {292.50000000, 241.50000000, 241.93181818, 0, 0, 0, 0},
        .lower_line_slope = {-4.95081397, -0.62333997, -0.18264122, 0, 0, 0, 0},
        .lower_line_offset = {771.46450775, 202.34940780, 135.05015736, 0, 0, 0, 0},
        .upper_line_slope = {-0.95003818, -0.60443022, -0.61363631, 0, 0, 0, 0},
        .upper_line_offset = {313.94513029, 257.88437005, 259.53077303, 0, 0, 0, 0},
        .corner_limit = {124.70064701, 154.09480271, 145.29935299, 175.90519729, 207.15475670, 97.21515907, 222.84524330, 122.78484093},
    },


};

const _Sensor_AE gc2083_ae_init = 
{
    .max_frame_length      = 1323,
    .min_frame_vb          = 1,
    .max_analog_gain       = 24<<8,
    .min_analog_gain       = 1<<8,
    .default_exposure_line = 1322,
    .max_exposure_line     = 1322,
    .min_exposure_line     = 1,
    .row_time_us           = 28,
    .expo_frame_interval   = 2,
    .to_day_bv             = 962,       // 10lux
    .to_night_bv           = 465,
    .dark_scene_target_lut = {35, 54},
    .dark_scene_bv_lut     = {34, 280},
    .hs_scene_limit_lut    = {55, 75},
    .hs_scene_bv_lut       = {280, 3534},
    .lowlight_lsb_bv_lut   = {34, 115, 222, 400, 791, 1599, 3534,  1e30},
    .lowlight_lsb_gain_lut = {64, 52,  46,   35,  25,  20,   16,   16},  // u7.4
};

const _Sensor_DPC gc2083_dpc_init = 
{
    .static_psram_addr      = (uint32)0,
    .white_threshold        = 115,
    .black_threshold        = 115,
    .white_threshold_min    = 30,
    .black_threshold_min    = 30,
    .sensitivity_value      = 128,
    .dynamic_white_strength = 4,
    .dynamic_black_strength = 4,
};

const _Sensor_CSC gc2083_csc_init = 
{
    .rgb2yuv_gamut         = ISP_YUV_GAMUT_BT709,
    .rgb2yuv_range         = ISP_YUV_RANGE_NARROW,
    .yuv2rgb_in_gamut      = ISP_YUV_GAMUT_BT709,
    .yuv2rgb_in_range      = ISP_YUV_RANGE_NARROW,
    .yuv2rgb_out_gamut     = ISP_YUV_GAMUT_BT709,
    .yuv2rgb_out_range     = ISP_YUV_RANGE_NARROW,
    .y_gamma_alpha         = 0xff,
    .rgb_gamma_alpha       = 0xff,
};

const _Sensor_GIC gc2083_gic_init = 
{
    .w_thres  = 14,
    .w_slope  = 16,
    .w_str    = 127,
    .mu_thres = 5,
    .mu_slope = 16,
};

const _Sensor_CSUPP gc2083_csupp_init = {
// u8  U_luma_thr_lo, U_luma_slop_lo, U_luma_shfb_lo, U_luma_gmin_lo,
// u8  U_luma_thr_hi, U_luma_slop_hi, U_luma_shfb_hi, U_luma_gmin_hi,
// u8  V_luma_thr_lo, V_luma_slop_lo, V_luma_shfb_lo, V_luma_gmin_lo,
// u8  V_luma_thr_hi, V_luma_slop_hi, V_luma_shfb_hi, V_luma_gmin_hi,
// u8  chroma_thr_lo, chroma_slop_lo, chroma_shfb_lo, chroma_gmin_lo,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
    209,   4,   0,   0,
     31,   4,   0,   0,
};

const _Sensor_SHARP gc2083_sharp_init = {
    .filt_alpha      = 128 ,
    .shrink_thr      = 5   ,
    .filt_clip_hi    = 127 ,
    .filt_clip_lo    = 127 ,
    
    .sp_thr2 		 = 20  ,    
    .sp_thr1 	 	 = 10  ,
    .enha_clip_hi 	 = 127 ,
    .enha_clip_lo	 = 127 ,
    
    .e1 = 8,  .e2 = 28, .e3 = 40,
    .k0 = 96, .k1 = 32, .k2 = 32, .k3 = 16,
    .y1 = 24,              // y1 = k0*e1
    .y2 = 44,              // y2 = k1*e2 + (y1 - k1*e1) = k1 * (e2 - e1) + y1
    .y3 = 56,              // y3 = k2*e3 + (y2 - k2*e2) = k2 * (e3 - e2) + y2

    // --- Unsharp Mask ---
    .filt_w11 = 7,  .filt_w12 = 9,  .filt_w13 = 10,
    .filt_w21 = 9,  .filt_w22 = 11, .filt_w23 = 12,
    .filt_w31 = 10, .filt_w32 = 12, .filt_w33 = 24,
    .filt_type = 1,
    .filt_sbit = 8,
    .lpf_scale = 1,

    // --- Sharpen Mask --- 
    // .filt_w11 = -2,  .filt_w12 = -12, .filt_w13 = -19,
    // .filt_w21 = -12, .filt_w22 = -24, .filt_w23 =  20,
    // .filt_w31 = -19, .filt_w32 =  20, .filt_w33 = 196,
    // .filt_type = 0,
    // .filt_sbit = 8,
    // .lpf_scale = 0,

    // .filt_w11 = 0,  .filt_w12 = 0,  .filt_w13 = -1,
    // .filt_w21 = 0,  .filt_w22 = -1, .filt_w23 = -2,
    // .filt_w31 = -1, .filt_w32 = -2, .filt_w33 = 16,
    // .filt_type = 0,
    // .filt_sbit = 4,
    // .lpf_scale = 0,

    .strength_lut    = {32,  255},
    .strength_bv_lut = {791, 9930},
};

const _Sensor_YUVNR gc2083_yuvnr_init = {
    .y_thr_tal0 = 20,
	.y_thr_tal1 = 20,
	.y_thr_tal2 = 20,
	.y_thr_tal3 = 20,
	.y_thr_tal4 = 20,
	.y_thr_tal5 = 20,
	.y_thr_tal6 = 20,
	.y_thr_tal7 = 20,
	.y_alfa     = 205,
	.c_alfa     = 255,
	.y_win_size = 0,
};

const _Sensor_COLENH gc2083_colenh_init = {
    .yuv_range  = 0,
    .luma       = 50, // range: 0 ~ 100
    .contrast   = 50, // range: 0 ~ 100
    .saturation = 70, // range: 0 ~ 100
    .hue        = 0, // range: -180 ~ 180
    .ce_in_ofs_y   = 128,
    .ce_in_ofs_cb  = 128,
    .ce_in_ofs_cr  = 128, // range: -128 ~ 128
    .ce_out_ofs_y  = 128, 
    .ce_out_ofs_cb = 128, 
    .ce_out_ofs_cr = 128, // range: -128 ~ 128
    .adj_sat_by_bv = 1,
    .hi_sat     = 100,
    .lo_sat     = 50,
    .hi_sat_bv  = 5000, // high brightness for saturation
    .lo_sat_bv  = 650,  // low brightness for saturation
};
// 1.0 - 0.01lux TBD
const _Sensor_BV2NR gc2083_bv2nr_init[BV2RAWNR_ARRAY_NUM] = {
    //        bv, bnr_range_weight_index, bnr_invksigma, bnr_intensity_threshold, yuvnr_idx, csupp_idx,  h264_3dnr_lev, h264_3dnr_en
    {      29491,                     6 ,           511,                      63,         0,         0,         0,              0},    // 320lux
    {       3534,                     8 ,           407,                      63,         0,         0,         1,              1},    // 40lux
    {       1599,                     8 ,           271,                      63,         1,         0,         1,              1},    // 20lux
    {        791,                     16,           271,                      63,         1,         1,         2,              1},    // 10lux
    {        222,                     16,           135,                      48,         2,         1,         2,              1},    // 5p03lux
    {        115,                     16,           135,                      48,         2,         1,         2,              1},    // 2p5lux
    {         57,                     20,           101,                      32,         3,         1,         2,              1},    // 1p25lux
    {         34,                     24,            62,                      32,         4,         1,         2,              1},    // 0p62lux
    {         26,                     26,            50,                      32,         4,         1,         2,              1},    // 0p31lux
    {         21,                     28,            40,                      32,         5,         2,         2,              1},    // 0p1lux
    {         16,                     31,            25,                      32,         5,         2,         2,              1},    // 0p01lux
};


const uint32 gc2083_lsc_tbl[] = {
//R channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//GR channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//GB channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
//B channel
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,0x00040100,
};

const _Sensor_LSC          gc2083_lsc_init = {
    .p_lsc_tbl = (uint32 *)gc2083_lsc_tbl,
};

const _Sensor_LHS gc2083_lhs_map[] = {
    // region defination: lower -> center -> upper(direction: anticlockwise)
    // region_lower, region_center, region_upper, hue adjust value, saturation adjust value
    //   (9 bits)      (9 bits)       (9 bits)          (9 bits)           (8 bits)
    {            24,            52,           80,                0,                       0},  // magenta,          range: 28
    {            80,           109,          138,                0,                       0},  // red,              range: 29
    {           140,           171,          202,                0,                       0},  // yellow,           range: 31
    {           204,           232,          260,                0,                       0},  // green,            range: 28
    {           261,           289,          317,                0,                       0},  // cyan,             range: 28
    {           320,           351,           22,                0,                       0},  // blue,             range: 31
    {           109,           132,          156,                0,                       0},  // skin enhance,     range:
    {           160,           203,          247,                0,                       0},  // green enhance(plants),    range:
    {           296,           318,          340,                0,                       0}   // blue enhance,     range:
};

const _Sensor_YGAMMA gc2083_ygamma_tbl[] = {
    0x00E01C00,  0x01D0540E,  0x02D0941D,  0x0400D82D,  0x05412840,  0x06B17C54,  0x0821DC6B,  0x09A23882,  
    0x0B12949A,  0x0C92F4B1,  0x0E0354C9,  0x0F73B0E0,  0x10B404F7,  0x11C4510B,  0x12C4911C,  0x13A4CD2C,
    0x1485053A,  0x15553948,  0x16257155,  0x1705A562,  0x17D5D970,  0x18A6117D,  0x1986458A,  0x1A567998,
    0x1B26ADA5,  0x1BF6E1B2,  0x1CC719BF,  0x1D974DCC,  0x1E6781D9,  0x1F37B5E6,  0x2007E9F3,  0x20E81E00,
    0x21B8520E,  0x22988A1B,  0x2378C229,  0x2458FA37,  0x25393245,  0x26296E53,  0x2719AA62,  0x2809E671,
    0x290A2280,  0x29FA5E90,  0x2AFA9E9F,  0x2BFADEAF,  0x2D0B1EBF,  0x2E0B62D0,  0x2F0B9EE0,  0x300BE2F0,
    0x310C2300,  0x320C6310,  0x32FCA320,  0x340CDF2F,  0x350D2340,  0x360D5F50,  0x370D9F60,  0x380DE370,
    0x390E2380,  0x3A0E6390,  0x3B0EA3A0,  0x3BFEE3B0,  0x3CFF23BF,  0x3E0F63CF,  0x3F0FA3E0,  0x3FFFE3F0,
};

// const _Sensor_WDR gc2083_wdr_init = {
//     .wdr_bv           = {400, 791, 1599, 3534,  7000, 14000, 28000, 56000},
//     .max_ns_slope     = {1.0, 1.0,  1.0,  1.0,   1.5,  1.5,    2.0,   3.0},
//     .max_shadow_slope = {1.0, 1.0,  1.0,  1.0,   1.5,  1.5,    1.5,   1.5},
// };
const _Sensor_WDR gc2083_wdr_init = {
    .wdr_bv           = {791, 1599, 3534,  7000, 10000, 14000, 28000, 56000},
    .max_ns_slope     = {1.0,  1.0,  1.0,   1.0,  1.25,   1.5,   2.0,   3.0},
    .max_shadow_slope = {1.0,  1.0,  1.0,   1.0,   1.0,  1.25,   1.5,   1.5},
};

uint8 gc2083_regValTable[29][13] = {
    // 0x00d0  0x0dc1  0x00b8  0x00b9  0x0155  0x0410  0x0411  0x0412  0x0413  0x0414  0x0415  0x0416  0x0417
    {0x00, 0x00, 0x01, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x10, 0x00, 0x01, 0x0c, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x01, 0x00, 0x01, 0x1a, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x11, 0x00, 0x01, 0x2b, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x02, 0x00, 0x02, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x12, 0x00, 0x02, 0x18, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x03, 0x00, 0x02, 0x33, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x13, 0x00, 0x03, 0x15, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x04, 0x00, 0x04, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x14, 0x00, 0x04, 0xe0, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x05, 0x00, 0x05, 0x26, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x15, 0x00, 0x06, 0x2b, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x44, 0x00, 0x08, 0x00, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x54, 0x00, 0x09, 0x22, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x45, 0x00, 0x0b, 0x0d, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x55, 0x00, 0x0d, 0x16, 0x03, 0x11, 0x11, 0x11, 0x11, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x04, 0x01, 0x10, 0x00, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x14, 0x01, 0x13, 0x04, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x24, 0x01, 0x16, 0x1a, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x34, 0x01, 0x1a, 0x2b, 0x19, 0x16, 0x16, 0x16, 0x16, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x44, 0x01, 0x20, 0x00, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x54, 0x01, 0x26, 0x07, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x64, 0x01, 0x2c, 0x33, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x74, 0x01, 0x35, 0x17, 0x36, 0x18, 0x18, 0x18, 0x18, 0x6f, 0x6f, 0x6f, 0x6f},
    {0x84, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x94, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x85, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0x95, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
    {0xa5, 0x01, 0x35, 0x17, 0x64, 0x16, 0x16, 0x16, 0x16, 0x72, 0x72, 0x72, 0x72},
};

uint32 gc2083_gainLevelTable[30] = {
    64,
    77,
    92,
    110,
    128,
    154,
    186,
    223,
    269,
    323,
    381,
    457,
    544,
    653,
    762,
    914,
    1078,
    1293,
    1541,
    1849,
    2177,
    2612,
    3136,
    3764,
    4710,
    5652,
    6656,
    7988,
    9474,
    0xffffffff
};

void GC2083_ae_adjust(struct isp_ae_func_cfg *p_cfg)
{
    uint8 i;
    uint8 index         = 0;
    int   gc2083_total  = sizeof(gc2083_gainLevelTable) / sizeof(uint32);
    uint32 tol_dig_gain = 0;
    uint32 gain         = (p_cfg->analog_gain) >> 2;
    uint8  *addr        = (uint8 *)p_cfg->data.addr;

    for (i = 0; i < gc2083_total; i++)
    {
        if ((gc2083_gainLevelTable[i] <= gain) && (gain < gc2083_gainLevelTable[i + 1]))
            break;
    }

    tol_dig_gain = gain * 64 / gc2083_gainLevelTable[i];

    addr[index++] = 0x00;
    addr[index++] = 0xd0;
    addr[index++] = gc2083_regValTable[i][0];
    addr[index++] = 0x03;
    addr[index++] = 0x1d;
    addr[index++] = 0x2e;
    addr[index++] = 0x0d;
    addr[index++] = 0xc1;
    addr[index++] = gc2083_regValTable[i][1];
    addr[index++] = 0x03;
    addr[index++] = 0x1d;
    addr[index++] = 0x28;
    addr[index++] = 0x00;
    addr[index++] = 0xb8;
    addr[index++] = gc2083_regValTable[i][2];
    addr[index++] = 0x00;
    addr[index++] = 0xb9;
    addr[index++] = gc2083_regValTable[i][3];
    addr[index++] = 0x01;
    addr[index++] = 0x55;
    addr[index++] = gc2083_regValTable[i][4];
    addr[index++] = 0x04;
    addr[index++] = 0x10;
    addr[index++] = gc2083_regValTable[i][5];
    addr[index++] = 0x04;
    addr[index++] = 0x11;
    addr[index++] = gc2083_regValTable[i][6];
    addr[index++] = 0x04;
    addr[index++] = 0x12;
    addr[index++] = gc2083_regValTable[i][7];
    addr[index++] = 0x04;
    addr[index++] = 0x13;
    addr[index++] = gc2083_regValTable[i][8];
    addr[index++] = 0x04;
    addr[index++] = 0x14;
    addr[index++] = gc2083_regValTable[i][9];
    addr[index++] = 0x04;
    addr[index++] = 0x15;
    addr[index++] = gc2083_regValTable[i][10];
    addr[index++] = 0x04;
    addr[index++] = 0x16;
    addr[index++] = gc2083_regValTable[i][11];
    addr[index++] = 0x04;
    addr[index++] = 0x17;
    addr[index++] = gc2083_regValTable[i][12];
    addr[index++] = 0x00;
    addr[index++] = 0xb1;
    addr[index++] = (tol_dig_gain >> 6);
    addr[index++] = 0x00;
    addr[index++] = 0xb2;
    addr[index++] = ((tol_dig_gain & 0x3f) << 2);
    addr[index++] = 0x0d;
    addr[index++] = 0x03;
    addr[index++] = (uint8)(p_cfg->exposure_line >> 8);
    addr[index++] = 0x0d;
    addr[index++] = 0x04;
    addr[index++] = (uint8)(p_cfg->exposure_line & 0xff);
    p_cfg->data.size = index;
    p_cfg->cmd_len   = 2+1;
}

const _Sensor_ISP_Init gc2083_isp_init = 
{
    .type         = ISP_INPUT_DAT_SRC_MIPI0,
    .pixel_h      = 1080,
    .pixel_w      = 1920,
    .bayer_patten = ISP_BAYER_FORMAT_RGGB,
    .input_format = ISP_INPUT_DAT_FORMAT_RAW10,
    .adjust_func  = (isp_ae_func     )GC2083_ae_adjust,
    .p_blc        = (_Sensor_BLC    *)&gc2083_blc_init,
    .p_ccm        = (_Sensor_CCM    *)&gc2083_ccm_init,
    .p_awb        = (_Sensor_AWB    *)&gc2083_awb_init,
    .p_ae         = (_Sensor_AE     *)&gc2083_ae_init,
    .p_dpc        = (_Sensor_DPC    *)&gc2083_dpc_init,
	.p_csc        = (_Sensor_CSC    *)&gc2083_csc_init,
	.p_gic        = (_Sensor_GIC    *)&gc2083_gic_init,
    .p_csupp      = (_Sensor_CSUPP  *)&gc2083_csupp_init,
    .p_sharp      = (_Sensor_SHARP  *)&gc2083_sharp_init,
    .p_yuvnr      = (_Sensor_YUVNR  *)&gc2083_yuvnr_init,    
    .p_colenh     = (_Sensor_COLENH *)&gc2083_colenh_init,
    .p_bv2nr      = (_Sensor_BV2NR  *)gc2083_bv2nr_init,    
    .p_lsc        = (_Sensor_LSC    *)&gc2083_lsc_init,
    .p_lhs        = (_Sensor_LHS    *)gc2083_lhs_map,
    .p_ygamma     = (_Sensor_YGAMMA *)gc2083_ygamma_tbl,
    .p_wdr        = (_Sensor_WDR    *)&gc2083_wdr_init,


};

SENSOR_OP_SECTION const _Sensor_Adpt_ gc2083_cmd = 
{
	.typ = 1, //YUV
	.pixelw = 1920,
	.pixelh= 1080,
	.hsyn = 1,
	.vsyn = 1,
	.rduline = 0,//
	.rawwide = 1,//10bit
	.colrarray = 0,//0:_RGRG_ 1:_GRGR_,2:_BGBG_,3:_GBGB_
	.init = (uint8 *)GC2083InitTable,
    .init_len = sizeof(GC2083InitTable),
    .mipi_lane_num = 2,
	.rotate_adapt = {0},
	//.hvb_adapt = {0x6a,0x12,0x6a,0x12},
	. mclk = 24000000,
	.p_fun_adapt = {NULL,NULL,NULL},
    .sensor_isp = (_Sensor_ISP_Init *)&gc2083_isp_init,
};

const _Sensor_Ident_ gc2083_init =
{
	0x83, 0x6e, 0x6f, 0x02, 0x01, 0x03f1
};

#endif

